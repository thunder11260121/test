
function loadFavs(){try{return JSON.parse(localStorage.getItem("favorites")||"[]");}catch(_){return[];}}
function gmapsLink(lat,lon){return `https://www.google.com/maps/search/?api=1&query=${lat}%2C${lon}`;}
function appleMapsLink(lat,lon,name){const q=encodeURIComponent(name||'目的地');return `https://maps.apple.com/?ll=${lat},${lon}&q=${q}`;}
function render(){const list=document.getElementById("favList");const favs=loadFavs();list.innerHTML="";if(!favs.length){const li=document.createElement("li");li.className="item";li.textContent="お気に入りはまだありません。スポット/たべるから追加できます。";list.appendChild(li);return;}favs.forEach(s=>{const li=document.createElement("li");li.className="item";li.innerHTML=`<div><strong>${s.name||'スポット'}</strong><div class="meta">${s.lat.toFixed(4)}, ${s.lon.toFixed(4)}</div></div><div class="actions vstack"><a class="iconbtn gmaps" target="_blank" rel="noopener" href="${gmapsLink(s.lat,s.lon)}"><svg viewBox='0 0 24 24' aria-hidden='true'><path d='M12 2C7.6 2 4 5.6 4 10c0 6 8 12 8 12s8-6 8-12c0-4.4-3.6-8-8-8z' fill='#EA4335'/><circle cx='12' cy='10' r='5' fill='#fff'/><text x='12' y='13' text-anchor='middle' font-size='8' font-family='Arial' fill='#1a73e8' font-weight='700'>G</text></svg></a><a class="iconbtn amaps" target="_blank" rel="noopener" href="${appleMapsLink(s.lat,s.lon,s.name)}"><svg viewBox='0 0 24 24' aria-hidden='true'><rect x='3' y='3' width='18' height='18' rx='4' fill='#e2e8f0' stroke='#cbd5e1'/><path d='M7 14l3-3 2 2 4-4' fill='none' stroke='#0ea5e9' stroke-width='2'/><circle cx='16' cy='9' r='2' fill='#94a3b8'/></svg></a></div>`;list.appendChild(li);});}
window.addEventListener("load",()=>{render();if("serviceWorker"in navigator){navigator.serviceWorker.register("./sw.js");}});
