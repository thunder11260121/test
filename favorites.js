function loadFavs(){try{return JSON.parse(localStorage.getItem("favorites")||"[]");}catch(_){return[];}}
function gmapsLink(lat,lon){return `https://www.google.com/maps/search/?api=1&query=${lat}%2C${lon}`;}
function appleMapsLink(lat,lon,name){const q=encodeURIComponent(name||'目的地');return `https://maps.apple.com/?ll=${lat},${lon}&q=${q}`;}
function render(){const list=document.getElementById("favList");const favs=loadFavs();list.innerHTML="";if(!favs.length){const li=document.createElement("li");li.className="spot";li.textContent="お気に入りはまだありません。スポットページで⭐を押すと追加できます。";list.appendChild(li);return;}favs.forEach(s=>{const li=document.createElement("li");li.className="spot";li.innerHTML=`<div><strong>${s.name||'スポット'}</strong><div class="meta">${s.lat.toFixed(4)}, ${s.lon.toFixed(4)}</div></div><div class="actions"><a class="btn" target="_blank" rel="noopener" href="${gmapsLink(s.lat,s.lon)}">Googleマップ</a><a class="btn" target="_blank" rel="noopener" href="${appleMapsLink(s.lat,s.lon,s.name)}">Appleマップ</a></div>`;list.appendChild(li);});}
window.addEventListener("load",()=>{render();if("serviceWorker"in navigator){navigator.serviceWorker.register("./sw.js");}});
document.getElementById("addToHome").addEventListener("click",()=>alert("共有 → 『ホーム画面に追加』でアプリ化できます。"));
